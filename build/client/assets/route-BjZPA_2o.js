import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r as n}from"./index-RUgJCupv.js";import{a as L}from"./index-t--hEgTQ.js";function q(){const[E,R]=n.useState([]),[A,h]=n.useState([]),[B,k]=n.useState(!0),[a,u]=n.useState({id:null,name:"",lastName:"",email:"",password:"",dateBirth:"",role:"user"}),[m,p]=n.useState(!1),[b,l]=n.useState(""),r=L.create({baseURL:"http://3.142.142.153:5000/api"});r.interceptors.request.use(s=>{const t=localStorage.getItem("authToken");return t&&(s.headers.Authorization=`Bearer ${t}`),s}),n.useEffect(()=>{(async()=>{var t,d;try{const[x,F,I]=await Promise.all([r.get("/User"),r.get("/Roles"),r.get("/UserRoles")]),f=x.data,w=F.data,v=I.data,U=(t=w.find(o=>o.name==="user"))==null?void 0:t.id,C=(d=w.find(o=>o.name==="admin"))==null?void 0:d.id;if(U===void 0||C===void 0){console.error("No se encontraron los roles 'user' o 'admin'.");return}const _=f.filter(o=>v.some(c=>c.users_id===o.id&&c.role_id===C)),D=f.filter(o=>v.some(c=>c.users_id===o.id&&c.role_id===U));R(_),h(D)}catch(x){console.error("Error al obtener datos:",x)}finally{k(!1)}})()},[]);const i=s=>{const{name:t,value:d}=s.target;u({...a,[t]:d})},S=async s=>{s.preventDefault(),l("");try{if(m)await r.put(`/User/${a.id}`,a),l("Usuario actualizado exitosamente.");else{const d=(await r.post("/auth/register",{name:a.name,lastName:a.lastName,email:a.email,password:a.password,dateBirth:a.dateBirth})).data;a.role==="admin"?(await r.post("/UserRoles",{users_id:d.id,role_id:2}),l("Usuario creado como administrador exitosamente.")):l("Usuario creado exitosamente.")}N(),j()}catch(t){console.error("Error al guardar el usuario:",t),t.response&&t.response.data?l(`Error: ${t.response.data.message||"No se pudo guardar el usuario."}`):l("Hubo un error al guardar el usuario.")}},g=s=>{u({id:s.id,name:s.name,lastName:s.lastName,email:s.email,password:"",dateBirth:s.dateBirth||"",role:"user"}),p(!0)},y=async s=>{try{await r.delete(`/User/${s}`),l("Usuario eliminado exitosamente."),N()}catch(t){console.error("Error al eliminar el usuario:",t),l("Hubo un error al eliminar el usuario.")}},N=async()=>{try{const s=await r.get("/User");h(s.data)}catch(s){console.error("Error al refrescar la lista de usuarios:",s)}},j=()=>{u({id:null,name:"",lastName:"",email:"",password:"",dateBirth:"",role:"user"}),p(!1)};return B?e.jsx("p",{children:"Cargando datos..."}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-center text-blue-900 mb-8",children:"Gestión de Usuarios"}),e.jsxs("form",{onSubmit:S,className:"max-w-lg mx-auto bg-white p-6 rounded-lg shadow-md mb-8",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 text-gray-700",children:[m?"Editar":"Crear"," Usuario"]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"name",className:"block text-gray-700 font-semibold mb-2",children:"Nombre"}),e.jsx("input",{type:"text",id:"name",name:"name",value:a.name,onChange:i,required:!0,className:"w-full px-4 py-3 border rounded bg-gray-100 text-gray-700 text-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"lastName",className:"block text-gray-700 font-semibold mb-2",children:"Apellido"}),e.jsx("input",{type:"text",id:"lastName",name:"lastName",value:a.lastName,onChange:i,required:!0,className:"w-full px-4 py-3 border rounded bg-gray-100 text-gray-700 text-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"email",className:"block text-gray-700 font-semibold mb-2",children:"Correo Electrónico"}),e.jsx("input",{type:"email",id:"email",name:"email",value:a.email,onChange:i,required:!0,className:"w-full px-4 py-3 border rounded bg-gray-100 text-gray-700 text-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"dateBirth",className:"block text-gray-700 font-semibold mb-2",children:"Fecha de Nacimiento"}),e.jsx("input",{type:"date",id:"dateBirth",name:"dateBirth",value:a.dateBirth,onChange:i,required:!0,className:"w-full px-4 py-3 border rounded bg-gray-100 text-gray-700 text-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),!m&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"password",className:"block text-gray-700 font-semibold mb-2",children:"Contraseña"}),e.jsx("input",{type:"password",id:"password",name:"password",value:a.password,onChange:i,required:!0,className:"w-full px-4 py-3 border rounded bg-gray-100 text-gray-700 text-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"role",className:"block text-gray-700 font-semibold mb-2",children:"Rol"}),e.jsxs("select",{id:"role",name:"role",value:a.role,onChange:i,className:"w-full px-4 py-3 border rounded bg-gray-100 text-gray-700 text-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"user",children:"Usuario"}),e.jsx("option",{value:"admin",children:"Administrador"})]})]}),e.jsx("button",{type:"submit",className:"bg-blue-500 text-white font-bold py-3 px-5 rounded hover:bg-blue-600 transition duration-200",children:m?"Actualizar":"Crear"}),e.jsx("button",{type:"button",onClick:j,className:"ml-4 bg-gray-500 text-white font-bold py-3 px-5 rounded hover:bg-gray-600 transition duration-200",children:"Cancelar"})]}),b&&e.jsx("p",{className:"text-center text-green-500 font-bold mb-4",children:b}),e.jsx("h2",{className:"text-2xl font-bold text-blue-900 mb-4",children:"Lista de Administradores"}),e.jsxs("table",{className:"table-auto w-full bg-white shadow-md rounded-lg mb-8",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-200 text-gray-700",children:[e.jsx("th",{className:"px-4 py-2",children:"ID"}),e.jsx("th",{className:"px-4 py-2",children:"Nombre"}),e.jsx("th",{className:"px-4 py-2",children:"Apellido"}),e.jsx("th",{className:"px-4 py-2",children:"Correo"}),e.jsx("th",{className:"px-4 py-2",children:"Fecha de Nacimiento"}),e.jsx("th",{className:"px-4 py-2",children:"Acciones"})]})}),e.jsx("tbody",{children:E.map(s=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-2",children:s.id}),e.jsx("td",{className:"px-4 py-2",children:s.name}),e.jsx("td",{className:"px-4 py-2",children:s.lastName}),e.jsx("td",{className:"px-4 py-2",children:s.email}),e.jsx("td",{className:"px-4 py-2",children:s.dateBirth}),e.jsxs("td",{className:"px-4 py-2 flex space-x-2",children:[e.jsx("button",{onClick:()=>g(s),className:"bg-yellow-500 text-white py-1 px-3 rounded hover:bg-yellow-600",children:"Editar"}),e.jsx("button",{onClick:()=>y(s.id),className:"bg-red-500 text-white py-1 px-3 rounded hover:bg-red-600",children:"Eliminar"})]})]},s.id))})]}),e.jsx("h2",{className:"text-2xl font-bold text-blue-900 mb-4",children:"Lista de Usuarios"}),e.jsxs("table",{className:"table-auto w-full bg-white shadow-md rounded-lg",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-200 text-gray-700",children:[e.jsx("th",{className:"px-4 py-2",children:"ID"}),e.jsx("th",{className:"px-4 py-2",children:"Nombre"}),e.jsx("th",{className:"px-4 py-2",children:"Apellido"}),e.jsx("th",{className:"px-4 py-2",children:"Correo"}),e.jsx("th",{className:"px-4 py-2",children:"Fecha de Nacimiento"}),e.jsx("th",{className:"px-4 py-2",children:"Acciones"})]})}),e.jsx("tbody",{children:A.map(s=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-2",children:s.id}),e.jsx("td",{className:"px-4 py-2",children:s.name}),e.jsx("td",{className:"px-4 py-2",children:s.lastName}),e.jsx("td",{className:"px-4 py-2",children:s.email}),e.jsx("td",{className:"px-4 py-2",children:s.dateBirth}),e.jsxs("td",{className:"px-4 py-2 flex space-x-2",children:[e.jsx("button",{onClick:()=>g(s),className:"bg-yellow-500 text-white py-1 px-3 rounded hover:bg-yellow-600",children:"Editar"}),e.jsx("button",{onClick:()=>y(s.id),className:"bg-red-500 text-white py-1 px-3 rounded hover:bg-red-600",children:"Eliminar"})]})]},s.id))})]})]})}function G(){return e.jsx(q,{})}export{G as default};

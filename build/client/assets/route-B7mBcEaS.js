import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{u as j}from"./authCOntext-Dl5rGXJ7.js";import{r as m}from"./index-RUgJCupv.js";import{a as w}from"./index-t--hEgTQ.js";function g(a){if(!a)return"";if(typeof a=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(a))return a;try{const o=new Date(a);return isNaN(o.getTime())?"":o.toISOString().slice(0,10)}catch{return""}}function y(){const{user:a,login:o}=j();if(!a)return e.jsx("div",{className:"flex justify-center items-center min-h-[60vh]",children:e.jsx("span",{className:"text-gray-500",children:"Cargando perfil..."})});const n=a.email??"",[t,u]=m.useState({name:a.name||"",lastName:a.lastName||"",email:n,dateBirth:g(a.dateBirth),imageUrl:a.imageUrl||"",password:""}),[h,p]=m.useState(""),[x,i]=m.useState(""),l=d=>{u(r=>({...r,[d.target.name]:d.target.value})),p(""),i("")},f=async d=>{d.preventDefault();try{if(!n){i("No se encontró el correo del usuario.");return}const r=a.role&&a.role.toLowerCase()==="admin"?`http://3.142.142.153:5000/api/admins/email/${encodeURIComponent(n)}`:`http://3.142.142.153:5000/api/users/email/${encodeURIComponent(n)}`,{password:b,...c}=t,s=b.trim()===""?c:{...c,password:b};!s.dateBirth||s.dateBirth==="string"?s.dateBirth="":typeof s.dateBirth=="string"&&!/^\d{4}-\d{2}-\d{2}$/.test(s.dateBirth)&&(s.dateBirth=g(s.dateBirth)),await w.put(r,s,{headers:{Authorization:`Bearer ${localStorage.getItem("authToken")||""}`}}),o({...a,...c},localStorage.getItem("authToken")||""),u(N=>({...N,password:""})),p("¡Datos actualizados!")}catch(r){r.response&&r.response.data&&r.response.data.message?i(r.response.data.message):i("Error actualizando. Intenta más tarde.")}};return e.jsx("section",{className:"flex flex-col items-center justify-center py-10 min-h-[80vh]",children:e.jsxs("form",{className:"bg-white shadow-md rounded p-8 max-w-md w-full",onSubmit:f,children:[t.imageUrl&&e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx("img",{src:t.imageUrl,alt:"Foto de perfil",className:"w-32 h-32 rounded-full object-cover border-4 border-gray-200 shadow-md"})}),e.jsx("h2",{className:"text-2xl font-bold mb-6 text-center",children:"Editar Perfil"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700",children:"Nombre"}),e.jsx("input",{className:"w-full border rounded p-2 bg-white text-black",name:"name",value:t.name,onChange:l,placeholder:"Nombre",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700",children:"Apellido"}),e.jsx("input",{className:"w-full border rounded p-2 bg-white text-black",name:"lastName",value:t.lastName,onChange:l,placeholder:"Apellido",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700",children:"Correo"}),e.jsx("input",{className:"w-full border rounded p-2 bg-gray-100 text-black",name:"email",value:t.email,disabled:!0,placeholder:"Correo",autoComplete:"email"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700",children:"Fecha de Nacimiento"}),e.jsx("input",{className:"w-full border rounded p-2 bg-white text-black",name:"dateBirth",value:t.dateBirth,onChange:l,type:"date",pattern:"\\d{4}-\\d{2}-\\d{2}",max:"2100-12-31"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700",children:"Foto (URL)"}),e.jsx("input",{className:"w-full border rounded p-2 bg-white text-black",name:"imageUrl",value:t.imageUrl,onChange:l,placeholder:"URL de Foto"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700",children:"Contraseña nueva"}),e.jsx("input",{className:"w-full border rounded p-2 bg-white text-black",name:"password",value:t.password,onChange:l,placeholder:"Dejar en blanco si no desea cambiarla",type:"password",autoComplete:"new-password"})]}),h&&e.jsx("p",{className:"text-green-600 mb-2",children:h}),x&&e.jsx("p",{className:"text-red-600 mb-2",children:x}),e.jsx("button",{className:"w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700",type:"submit",children:"Guardar Cambios"})]})})}function S(){return e.jsx(y,{})}export{S as default};
